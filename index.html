<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BMI 計算器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f8;
      text-align: center;
      padding: 20px;
      margin: 0;
      overflow-x: hidden;
      position: relative;
    }

    h2 {
      color: #333;
      font-size: 24px;
      margin-bottom: 20px;
    }

    input, select, button {
      font-size: 18px;
      padding: 12px;
      margin: 10px auto;
      width: 90%;
      max-width: 300px;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 8px;
    }

    #result {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
      position: relative;
      line-height: 1.6;
    }

    .falling {
      position: absolute;
      font-size: 250px;
      z-index: 10;
      animation: fall 3s ease-in forwards;
      pointer-events: none;
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 20px;
      border-radius: 3px;
      opacity: 0.9;
      transform: rotate(45deg);
      z-index: 5;
      pointer-events: none;
    }

    @keyframes fall {
      0%   { top: -400px; opacity: 0.8; transform: rotate(0deg); }
      50%  { transform: rotate(10deg); }
      100% { transform: rotate(-10deg); top: var(--fall-y); opacity: 1; }
    }

    @keyframes fallConfetti {
      0%   { top: -50px; opacity: 1; }
      100% { top: var(--fall-y); transform: rotate(360deg); opacity: 1; }
    }

    .shake {
      animation: shake 0.4s ease-in-out;
    }

    @keyframes shake {
      0% { transform: translateY(0); }
      25% { transform: translateY(-10px); }
      50% { transform: translateY(5px); }
      75% { transform: translateY(-5px); }
      100% { transform: translateY(0); }
    }
  </style>
</head>
<body>
  <h2>BMI 計算器</h2>

  <select id="gender">
    <option value="male">男生</option>
    <option value="female">女生</option>
  </select><br />

  <input id="height" type="number" placeholder="身高（公分）" /><br />
  <input id="weight" type="number" placeholder="體重（公斤）" /><br />
  <button onclick="calculateBMI()">計算 BMI</button>

  <div id="result"></div>

  <script>
    function calculateBMI() {
      const h = parseFloat(document.getElementById("height").value) / 100;
      const w = parseFloat(document.getElementById("weight").value);
      const gender = document.getElementById("gender").value;
      const result = document.getElementById("result");

      if (!h || !w) {
        result.innerText = "請正確輸入數值";
        return;
      }

      document.querySelectorAll('.falling, .confetti').forEach(el => el.remove());
      document.body.classList.remove("shake");

      const bmi = w / (h * h);
      let message = `你的 BMI 是 ${bmi.toFixed(2)}，`;

      const minWeight = (18.5 * h * h).toFixed(1);
      const maxWeight = (24 * h * h).toFixed(1);
      message += `<br>🔍 ${gender === 'male' ? '男生' : '女生'}理想體重區間：約 ${minWeight} ~ ${maxWeight} 公斤`;

      if (bmi < 18.5) {
        message = `你的 BMI 是 ${bmi.toFixed(2)}，體重過輕` + message;
        dropSymbol("🪶", result);
      } else if (bmi < 24) {
        message = `你的 BMI 是 ${bmi.toFixed(2)}，體重正常` + message;
        launchConfetti(result);
      } else {
        message = `你的 BMI 是 ${bmi.toFixed(2)}，體重過重` + message;
        dropSymbol("🪨", result);
        document.body.classList.add("shake");
      }

      result.innerHTML = message;
    }

    function dropSymbol(symbol, target) {
      const el = document.createElement("div");
      el.className = "falling";
      el.innerText = symbol;
      const targetRect = target.getBoundingClientRect();
      const fallY = targetRect.top + targetRect.height + 40;
      el.style.setProperty('--fall-y', `${fallY}px`);
      el.style.left = `${window.innerWidth / 2 - 120 + Math.random() * 60}px`;
      requestAnimationFrame(() => {
        document.body.appendChild(el);
      });
    }

    function launchConfetti(target) {
      const colors = ['#f94144', '#f3722c', '#f9c74f', '#90be6d', '#577590', '#277da1'];
      const targetRect = target.getBoundingClientRect();
      const fallY = targetRect.top + targetRect.height + 40;

      for (let i = 0; i < 60; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * window.innerWidth + 'px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.setProperty('--fall-y', `${fallY}px`);
        confetti.style.animation = `fallConfetti ${3 + Math.random()}s linear forwards`;
        document.body.appendChild(confetti);
      }
    }
  </script>
</body>
</html>
